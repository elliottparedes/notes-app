[build]
  command = "npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20.19.0"
  NUXT_TELEMETRY_DISABLED = "1"
  NODE_OPTIONS = "--max-old-space-size=4096"
  # Tell Netlify's scanner these environment variable NAMES are expected
  # This prevents false positives on variable names (not values!)
  SECRETS_SCAN_OMIT_KEYS = "DB_HOST,DB_PORT,DB_USER,DB_PASSWORD,DB_NAME,JWT_SECRET,OPENROUTER_API_KEY,MINIO_ACCESS_KEY,MINIO_BUCKET,MINIO_ENDPOINT,MINIO_SECRET_KEY,MONGODB_URI,NUXT_SESSION_PASSWORD,MYSQL_USERNAME,MYSQL_PASSWORD,MYSQL_CONNECTION_STRING,NODE_ENV"

# Nitro's Netlify preset handles routing automatically via functions-internal
# No manual redirects needed - Netlify auto-discovers the function

# Headers for better caching
[[headers]]
  for = "/_nuxt/builds/meta/*"
  [headers.values]
    cache-control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/_nuxt/builds/*"
  [headers.values]
    cache-control = "public, max-age=1, immutable"

[[headers]]
  for = "/_nuxt/*"
  [headers.values]
    cache-control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/manifest.webmanifest"
  [headers.values]
    Content-Type = "application/manifest+json"
    cache-control = "public, max-age=0, must-revalidate"

[[headers]]
  for = "/sw.js"
  [headers.values]
    cache-control = "public, max-age=0, must-revalidate"

# Environment variables should be set in Netlify UI
# Never commit actual secrets to the repository
# Required variables:
#   - DB_HOST, DB_PORT, DB_USER, DB_PASSWORD, DB_NAME
#   - JWT_SECRET
#   - OPENROUTER_API_KEY (optional, for AI features)
#   - MONGODB_URI, MINIO_* (if using those services)

